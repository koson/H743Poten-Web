<?xml version="1.0" encoding="utf-8" ?>
<ContentPage     x:Class="Poten2501.Pages.SWVPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:cc="clr-namespace:Poten2501.CustomControls"
    xmlns:converters="clr-namespace:Poten2501.Converters"
    xmlns:styles="clr-namespace:Poten2501.Styles"
    xmlns:viewModel="clr-namespace:Poten2501.ViewModels"
    Title="Square Wave Voltammetry"
    x:DataType="viewModel:SWVViewModel">
    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <styles:PageStyles />
            </ResourceDictionary.MergedDictionaries>
            <converters:VoltageConverter x:Key="VoltageConverter" />
            <converters:CurrentConverter x:Key="CurrentConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid>
        <Grid Style="{StaticResource GridStyles}">
            <Frame
            x:Name="FileOperationView"
            Grid.RowSpan="3"
            Style="{StaticResource ListViewStyle}">
                <VerticalStackLayout>
                    <Label
                    FontAttributes="Bold"
                    FontSize="Subtitle"
                    HorizontalTextAlignment="Center"
                    Text="Project Manager"
                    TextColor="#0055ff" />
                    <Label Text="Project Location" />
                    <HorizontalStackLayout>
                        <Entry
                        MaximumWidthRequest="180"
                        MinimumWidthRequest="180"
                        Text="{Binding WorkingFolderPath}" />
                        <Button
                        Margin="5"
                        Command="{Binding SelectProjectFolderCommand}"
                        Text="..." />
                    </HorizontalStackLayout>
                    <Label Padding="0,10,0,0" Text="Project Name" />
                    <Entry
                    Margin="0,5,0,0"
                    MaxLength="32"
                    Placeholder="Enter project name"
                    Text="{Binding ProjectName}" />
                    <Label Padding="0,10,0,0" Text="File Name" />
                    <Entry
                    Margin="0,5,0,0"
                    IsReadOnly="True"
                    MaxLength="32"
                    Placeholder="Generated file name"
                    Text="{Binding FileName}" />
                    <Label Padding="0,10,0,0" Text="Electrode No" />
                    <Picker
                        Margin="0,5,0,0"
                        MaximumWidthRequest="220"
                        ItemsSource="{Binding ElectrodeOptions}"
                        SelectedItem="{Binding ElectrodeNo}" />

                </VerticalStackLayout>
            </Frame>

            <Frame Style="{StaticResource MeasureParamsStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>
                    <Label
                    Grid.Column="0"
                    FontSize="Medium"
                    HorizontalTextAlignment="Center"
                    Text="Potential : "
                    TextColor="#0055cc"
                    VerticalTextAlignment="Center" />
                    <Label
                    Grid.Column="1"
                    Grid.ColumnSpan="3"
                    FontAttributes="Bold"
                    FontSize="Large"
                    HorizontalTextAlignment="Start"
                    Text="{Binding SwvVoltage, Converter={StaticResource VoltageConverter}}"
                    TextColor="#008800" />
                    <Label
                    Grid.Column="3"
                    FontSize="Medium"
                    HorizontalTextAlignment="Center"
                    Text="Current :  "
                    TextColor="#0055cc"
                    VerticalTextAlignment="Center" />
                    <Label
                    Grid.Column="4"
                    Grid.ColumnSpan="3"
                    FontAttributes="Bold"
                    FontSize="Large"
                    HorizontalTextAlignment="Start"
                    Text="{Binding SwvCurrent, Converter={StaticResource CurrentConverter}}"
                    TextColor="#008800" />
                </Grid>
            </Frame>

            <Frame Style="{StaticResource ScottplotStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <cc:PlotView
                    x:Name="SWVPlot"
                    DataX="{Binding DataX}"
                    DataY="{Binding DataY}" />
                    <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center" MinimumWidthRequest="150">
                        <Button
                        Margin="5"
                        Command="{Binding StartSWVScanCommand}"
                        Text="Start scan" />
                        <Button
                        Margin="5"
                        Command="{Binding AbortSWVScanCommand}"
                        Text="Stop scan" />
                        <Button
                        Margin="5"
                        Command="{Binding ClearChartCommand}"
                        Text="Clear Chart" />
                        <Button Margin="5" Text="Export CSV" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <Frame Style="{StaticResource SWVParametersStyle} ">
                <ScrollView MinimumWidthRequest="250">
                    <VerticalStackLayout Spacing="10">
                        <Label
                        FontAttributes="Bold"
                        FontSize="Subtitle"
                        HorizontalOptions="Center"
                        Text="SWV Parameters"
                        TextColor="#0055ff" />
                        <Grid ColumnSpacing="3" RowSpacing="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40*" />
                                <ColumnDefinition Width="50*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Label
                            Grid.Row="0"
                            Grid.Column="0"
                            Text="Frequency (Hz)"
                            VerticalTextAlignment="Center" />
                            <Picker
                                x:Name="pickerFrequency"
                                Grid.Row="0"
                                Grid.Column="1"
                                ItemsSource="{Binding PickerItems}" 
                                SelectedIndex="0"
                                SelectedIndexChanged="pickerFrequency_SelectedIndexChanged"
                                SelectedItem="{Binding SelectedPickerItem}" 
                                />
                            <Label
                            Grid.Row="1"
                            Grid.Column="0"
                            Text="Amplitude (V)"
                            VerticalTextAlignment="Center" />
                            <Entry
                            Grid.Row="1"
                            Grid.Column="1"
                            Placeholder="0.05"
                            Text="{Binding Amplitude}" />
                            <Label
                            Grid.Row="2"
                            Grid.Column="0"
                            Text="E step (V)"
                            VerticalTextAlignment="Center" />
                            <Entry
                            Grid.Row="2"
                            Grid.Column="1"
                            Placeholder="0.01"
                            Text="{Binding StepPotential}" />
                            <Label
                            Grid.Row="3"
                            Grid.Column="0"
                            Text="E begin (V)"
                            VerticalTextAlignment="Center" />
                            <Entry
                            Grid.Row="3"
                            Grid.Column="1"
                            Placeholder="-1.0"
                            Text="{Binding StartPotential}" />
                            <Label
                            Grid.Row="4"
                            Grid.Column="0"
                            Text="E end (V)"
                            VerticalTextAlignment="Center" />
                            <Entry
                            Grid.Row="4"
                            Grid.Column="1"
                            Placeholder="1.0"
                            Text="{Binding EndPotential}" />
                            <Label
                            Grid.Row="5"
                            Grid.Column="0"
                            Text="Scan Cycle"
                            VerticalTextAlignment="Center" />
                            <Entry
                            Grid.Row="5"
                            Grid.Column="1"
                            Placeholder="1"
                            Text="{Binding ScanCycle}" />

                        </Grid>
                    </VerticalStackLayout>
                </ScrollView>
            </Frame>
            
            <Frame Style="{StaticResource CommConnectStyle}">
                <ScrollView>
                    <VerticalStackLayout>
                        <Label
                            Margin="0,0,0,10"
                            FontAttributes="Bold"
                            FontSize="Subtitle"
                            HorizontalOptions="Center"
                            Text="Serial port connection"
                            TextColor="#0055ff" />
                        <Button Command="{Binding ConnectCommand}" Text="{Binding ConnectButtonText}" />
                        <Grid Margin="0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Text="Available Ports:"
                                VerticalTextAlignment="Center" />
                            <Picker
                                Grid.Row="0"
                                Grid.Column="1"
                                ItemsSource="{Binding AvailablePorts}"
                                SelectedItem="{Binding SelectedPort}" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Text="Baud Rate:"
                                VerticalTextAlignment="Center" />
                            <Picker
                                Grid.Row="1"
                                Grid.Column="1"
                                ItemsSource="{Binding BaudRates}"
                                SelectedItem="{Binding SelectedBaudRate}" />
                        </Grid>
                        <Button Command="{Binding RefreshPortsCommand}" Text="Refresh Ports" />
                    </VerticalStackLayout>
                </ScrollView>
            </Frame>
            
        </Grid>
    </Grid>
</ContentPage>