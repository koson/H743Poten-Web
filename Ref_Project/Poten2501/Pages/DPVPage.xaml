<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Poten2501.Pages.DPVPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:cc="clr-namespace:Poten2501.CustomControls"
    xmlns:controls="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
    xmlns:converters="clr-namespace:Poten2501.Converters"
    xmlns:skia="clr-namespace:SkiaSharp;assembly=SkiaSharp"
    xmlns:sp="clr-namespace:ScottPlot.Maui;assembly=ScottPlot.Maui"
    xmlns:styles="clr-namespace:Poten2501.Styles"
    xmlns:viewModel="clr-namespace:Poten2501.ViewModels"
    Title="Differential Pulse Voltammetry"
    x:DataType="viewModel:DPVPageViewModel">
    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <styles:PageStyles />
            </ResourceDictionary.MergedDictionaries>
            <converters:VoltageConverter x:Key="VoltageConverter" />
            <converters:CurrentConverter x:Key="CurrentConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid>
        <Grid Style="{StaticResource GridStyles}">
            <Frame
                x:Name="FileOperationView"
                Grid.RowSpan="3"
                Style="{StaticResource ListViewStyle}">
                <VerticalStackLayout>
                    <Label
                        FontAttributes="Bold"
                        FontSize="Subtitle"
                        HorizontalTextAlignment="Center"
                        Text="Project Manager"
                        TextColor="#0055ff" />
                    <Label Text="Project Location" />
                    <HorizontalStackLayout>
                        <Entry
                            MaximumWidthRequest="180"
                            MinimumWidthRequest="180"
                            Text="{Binding WorkingFolderPath}" />
                        <Button
                            Margin="5"
                            Command="{Binding SelectProjectFolderCommand}"
                            Text="..." />

                    </HorizontalStackLayout>
                    <Label Padding="0,10,0,0" Text="Project Name" />
                    <Entry
                        Margin="0,5,0,0"
                        MaxLength="32"
                        Placeholder="Enter project name"
                        Text="{Binding ProjectName}" />
                    <Label Padding="0,10,0,0" Text="File Name" />
                    <Entry
                        Margin="0,5,0,0"
                        IsReadOnly="True"
                        MaxLength="32"
                        Placeholder="Generated file name"
                        Text="{Binding FileName}" />
                </VerticalStackLayout>
            </Frame>

            <Frame Style="{StaticResource MeasureParamsStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>
                    <Label
                        Grid.Column="0"
                        FontSize="Medium"
                        HorizontalTextAlignment="Center"
                        Text="Potential : "
                        TextColor="#0055cc"
                        VerticalTextAlignment="Center" />
                    <Label
                        Grid.Column="1"
                        Grid.ColumnSpan="3"
                        FontAttributes="Bold"
                        FontSize="Large"
                        HorizontalTextAlignment="Start"
                        Text="{Binding DpvVoltage, Converter={StaticResource VoltageConverter}}"
                        TextColor="#008800" />
                    <Label
                        Grid.Column="3"
                        FontSize="Medium"
                        HorizontalTextAlignment="Center"
                        Text="Current :  "
                        TextColor="#0055cc"
                        VerticalTextAlignment="Center" />
                    <Label
                        Grid.Column="4"
                        Grid.ColumnSpan="3"
                        FontAttributes="Bold"
                        FontSize="Large"
                        HorizontalTextAlignment="Start"
                        Text="{Binding DpvCurrent, Converter={StaticResource CurrentConverter}}"
                        TextColor="#008800" />
                </Grid>
            </Frame>

            <Frame Style="{StaticResource ScottplotStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <cc:PlotView
                        x:Name="DPVPlot"
                        DataX="{Binding DataX}"
                        DataY="{Binding DataY}" />
                    <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Button
                            Margin="5"
                            Command="{Binding StartDPVScanCommand}"
                            Text="Start scan" />
                        <Button
                            Margin="5"
                            Command="{Binding AbortDPVScanCommand}"
                            Text="Stop scan" />
                        <Button
                            Margin="5"
                            Text="Clear Chart"
                            WidthRequest="100" />
                        <Button Margin="5" Text="Export CSV" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <Frame Style="{StaticResource DPVParametersStyle}">
                <ScrollView>
                    <VerticalStackLayout Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="Subtitle"
                            HorizontalOptions="Center"
                            Text="DPV Parameters"
                            TextColor="#0055ff" />
                        <Grid ColumnSpacing="3" RowSpacing="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40*" />
                                <ColumnDefinition Width="50*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                FontSize="Subtitle"
                                HorizontalOptions="Start"
                                Text="Sweep Parameters"
                                TextColor="#a00" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Text="Segments"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entNoOfSegments"
                                Grid.Row="1"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryNoOfSegmentsEnabled}"
                                StyleId="NoOfSegments"
                                Text="{Binding NoOfSegments}" />
                            <Label
                                Grid.Row="2"
                                Grid.Column="0"
                                Text="Scan Rate"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entScanRate"
                                Grid.Row="2"
                                Grid.Column="1" />
                            <Label
                                Grid.Row="3"
                                Grid.Column="0"
                                Text="Current Gain"
                                VerticalTextAlignment="Center" />
                            <Picker
                                x:Name="entCurrentGain"
                                Grid.Row="3"
                                Grid.Column="1"
                                ItemsSource="{Binding PickerItems}"
                                SelectedIndex="0"
                                SelectedIndexChanged="entCurrentGain_SelectedIndexChanged"
                                SelectedItem="{Binding SelectedPickerItem}" />
                            <Label
                                Grid.Row="4"
                                Grid.Column="0"
                                Text="Initial Potential (V)"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entInitialPotentialVolt"
                                Grid.Row="4"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryInitialPotentialVoltEnabled}"
                                StyleId="InitialPotentialVolt"
                                Text="{Binding InitialPotentialVolt}" />
                            <Label
                                Grid.Row="5"
                                Grid.Column="0"
                                Text="Final Potential (V)"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entFinalPotentialVolt"
                                Grid.Row="5"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryFinalPotentialVoltEnabled}"
                                StyleId="FinalPotentialVolt"
                                Text="{Binding FinalPotentialVolt}" />
                            <Label
                                Grid.Row="6"
                                Grid.Column="0"
                                Text="Lower Potential (V)"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entLowerPotentialVolt"
                                Grid.Row="6"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryLowerPotentialVoltEnabled}"
                                StyleId="LowerPotentialVolt"
                                Text="{Binding LowerPotentialVolt}" />
                            <Label
                                Grid.Row="7"
                                Grid.Column="0"
                                Text="Upper Potential (V)"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entUpperPotentialVolt"
                                Grid.Row="7"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryUpperPotentialVoltEnabled}"
                                StyleId="UpperPotentialVolt"
                                Text="{Binding UpperPotentialVolt}" />
                            <Label
                                Grid.Row="8"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                FontSize="Subtitle"
                                HorizontalOptions="Start"
                                Text="Differential Pulse Parameters"
                                TextColor="#a00" />
                            <Label
                                Grid.Row="9"
                                Grid.Column="0"
                                Text="Pulse Height"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulseHeight"
                                Grid.Row="9"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulseHeightEnabled}"
                                StyleId="DifferentialPulseHeight"
                                Text="{Binding DifferentialPulseHeight}" />
                            <Label
                                Grid.Row="10"
                                Grid.Column="0"
                                Text="Pulse Width"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulseWidth"
                                Grid.Row="10"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulseWidthEnabled}"
                                StyleId="DifferentialPulseWidth"
                                Text="{Binding DifferentialPulseWidth}" />
                            <Label
                                Grid.Row="11"
                                Grid.Column="0"
                                Text="Pulse Period"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulsePeriod"
                                Grid.Row="11"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulsePeriodEnabled}"
                                StyleId="DifferentialPulsePeriod"
                                Text="{Binding DifferentialPulsePeriod}" />
                            <Label
                                Grid.Row="12"
                                Grid.Column="0"
                                Text="Pulse Increment"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulseIncrement"
                                Grid.Row="12"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulseIncrementEnabled}"
                                StyleId="DifferentialPulseIncrement"
                                Text="{Binding DifferentialPulseIncrement}" />
                            <Label
                                Grid.Row="13"
                                Grid.Column="0"
                                Text="Pre-Pulse Width"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulsePrePulseWidth"
                                Grid.Row="13"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulsePrePulseWidthEnabled}"
                                StyleId="DifferentialPulsePrePulseWidth"
                                Text="{Binding DifferentialPulsePrePulseWidth}" />
                            <Label
                                Grid.Row="14"
                                Grid.Column="0"
                                Text="Post-Pulse Width"
                                VerticalTextAlignment="Center" />
                            <Entry
                                x:Name="entDifferentialPulsePostPulseWidth"
                                Grid.Row="14"
                                Grid.Column="1"
                                Completed="Entry_Completed"
                                IsEnabled="{Binding IsEntryDifferentialPulsePostPulseWidthEnabled}"
                                StyleId="DifferentialPulsePostPulseWidth"
                                Text="{Binding DifferentialPulsePostPulseWidth}" />
                        </Grid>
                    </VerticalStackLayout>
                </ScrollView>
            </Frame>

            <Frame IsVisible="Hidden" Style="{StaticResource TerminalStyle}">
                <VerticalStackLayout>
                    <Grid ColumnSpacing="3" RowSpacing="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="85*" />
                            <ColumnDefinition Width="15*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="10*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Label
                            FontAttributes="Bold"
                            FontSize="Subtitle"
                            Text="Messages" />
                        <Editor
                            Grid.Row="1"
                            Grid.Column="0"
                            Margin="5"
                            HeightRequest="180"
                            IsReadOnly="True"
                            Text="{Binding ReceivedData}" />
                        <Button
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="3"
                            Command="{Binding ClearReceivedDataCommand}"
                            HeightRequest="15"
                            Text="Clear Message"
                            VerticalOptions="Start"
                            WidthRequest="150" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame Style="{StaticResource CommConnectStyle}">
                <ScrollView>
                    <VerticalStackLayout>
                        <Label
                            Margin="0,0,0,10"
                            FontAttributes="Bold"
                            FontSize="Subtitle"
                            HorizontalOptions="Center"
                            Text="Serial port connection"
                            TextColor="#0055ff" />
                        <Button Command="{Binding ConnectCommand}" Text="{Binding ConnectButtonText}" />
                        <Grid Margin="0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Text="Available Ports:"
                                VerticalTextAlignment="Center" />
                            <Picker
                                Grid.Row="0"
                                Grid.Column="1"
                                ItemsSource="{Binding AvailablePorts}"
                                SelectedItem="{Binding SelectedPort}" />
                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Text="Baud Rate:"
                                VerticalTextAlignment="Center" />
                            <Picker
                                Grid.Row="1"
                                Grid.Column="1"
                                ItemsSource="{Binding BaudRates}"
                                SelectedItem="{Binding SelectedBaudRate}" />
                        </Grid>
                        <Button Command="{Binding RefreshPortsCommand}" Text="Refresh Ports" />
                    </VerticalStackLayout>
                </ScrollView>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>