<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H743Poten Analysis Workflow - Step by Step</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .workflow-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .workflow-header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .workflow-steps {
            padding: 20px;
        }

        .step {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .step.active {
            background: #e8f5e8;
            border-left-color: #2196F3;
        }

        .step.completed {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
            transition: all 0.3s ease;
        }

        /* Step Status Colors */
        .step-number {
            background: #6c757d;  /* สีเทา - ยังไม่ได้ทำ (default) */
        }

        .step.active .step-number {
            background: #ffc107;  /* สีเหลือง - กำลังทำ */
            animation: pulse 2s infinite;
        }

        .step.completed .step-number {
            background: #28a745;  /* สีเขียว - สำเร็จแล้ว */
        }

        .step.error .step-number {
            background: #dc3545;  /* สีแดง - มีข้อผิดพลาด */
        }

        .step.completed .step-number {
            background: #28a745;
        }

        .step.completed .step-number::after {
            content: '✓';
            font-size: 20px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .step-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        .step-content {
            margin-left: 55px;
        }

        .step-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .step-details {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 10px;
        }

        .file-selector {
            margin: 15px 0;
        }

        .file-selector input[type="file"] {
            margin: 10px 0;
        }

        .folder-path {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            color: #333;
            margin: 10px 0;
        }

        /* Instrument Grid Layout */
        .instrument-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
            padding: 0 10px;
        }

        .instrument-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            border: 2px solid #e1e8f0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            min-height: 200px;
        }

        .instrument-card:hover {
            transform: translateY(-5px);
            border-color: #4169E1;
            box-shadow: 0 8px 25px rgba(65,105,225,0.2);
        }

        .instrument-card.active {
            border-color: #4169E1;
            background: linear-gradient(135deg, #e8f0ff 0%, #f0f7ff 100%);
        }

        .instrument-header {
            margin-bottom: 15px;
        }

        .instrument-header h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 1.2em;
            font-weight: 600;
        }

        .quality-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
            display: inline-block;
        }

        .instrument-body {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .folder-button {
            background: linear-gradient(45deg, #4169E1, #6495ED);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(65,105,225,0.3);
        }

        .folder-button:hover {
            background: linear-gradient(45deg, #365cce, #5a85e6);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(65,105,225,0.4);
        }

        .instrument-details {
            width: 100%;
            text-align: left;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 6px;
            background: rgba(65,105,225,0.05);
            border-radius: 8px;
        }

        .detail-label {
            font-weight: 500;
            color: #666;
            font-size: 0.9em;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
        }

        .detail-value.status {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }

        .detail-value.status.ready {
            background: #d4edda;
            color: #155724;
        }

        .detail-value.status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .detail-value.status.done {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Data Preview Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .data-preview-modal {
            background-color: #fff;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #4169E1, #6495ED);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ff6b6b;
        }

        .modal-body {
            padding: 0;
            max-height: 70vh;
            overflow-y: auto;
        }

        .preview-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            background: white;
            border-bottom-color: #4169E1;
            color: #4169E1;
        }

        .tab-button:hover {
            background: rgba(65,105,225,0.1);
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* Summary Grid */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9ff, #e8f0ff);
            border: 1px solid #e1e8f0;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
        }

        .summary-icon {
            font-size: 2em;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #4169E1, #6495ED);
            color: white;
            border-radius: 50%;
        }

        .summary-info {
            flex: 1;
        }

        .summary-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #666;
            font-size: 0.9em;
        }

        /* Quality Analysis */
        .data-quality-analysis {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .data-quality-analysis h3 {
            margin-top: 0;
            color: #333;
        }

        .quality-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quality-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .quality-item:has(.quality-icon:contains("⚠️")) {
            border-left-color: #ffc107;
        }

        .quality-icon {
            font-size: 1.2em;
        }

        .quality-text {
            flex: 1;
            font-size: 0.95em;
        }

        /* Graph Container */
        .graph-container {
            text-align: center;
        }

        .sample-graph {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .graph-info {
            text-align: left;
            background: #e8f0ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .graph-info p {
            margin: 5px 0;
            font-size: 0.95em;
        }

        /* Statistics Grid */
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stat-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .stat-section h4 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4169E1;
            padding-bottom: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: #666;
        }

        .stat-value {
            font-weight: bold;
            color: #333;
        }

        .modal-footer {
            border-top: 1px solid #e0e0e0;
            padding: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: #f8f9fa;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4169E1, #6495ED);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #365cce, #5a85e6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .instrument-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .instrument-card {
                min-height: 180px;
                padding: 15px;
            }
        }

        @media (max-width: 1024px) {
            .instrument-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* New Data Import Sections Styles */
        .data-import-sections {
            margin: 20px 0;
        }

        .import-section {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin: 15px 0;
            padding: 20px;
            background: #f9f9f9;
            transition: all 0.3s ease;
        }

        .import-section:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: #333;
        }

        .section-header .instrument-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .section-title {
            font-size: 16px;
        }

        .file-label {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-weight: bold;
            margin: 10px 0;
        }

        .file-label:hover {
            background: #45a049;
        }

        .folder-info {
            margin: 10px 0;
            font-style: italic;
            color: #666;
        }

        .file-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 14px;
        }

        .stat {
            background: #e8f5e8;
            padding: 4px 8px;
            border-radius: 4px;
            color: #2e7d2e;
        }

        input[type="file"] {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .instrument-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .instrument-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .instrument-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .instrument-card.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .instrument-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .result-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }

        .result-label {
            color: #666;
            font-size: 0.9em;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-waiting {
            background: #ffc107;
        }

        .status-processing {
            background: #17a2b8;
            animation: blink 1s infinite;
        }

        .status-completed {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .visualization-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 300px;
            border: 2px dashed #ddd;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .visualization-placeholder {
            color: #666;
            font-size: 1.1em;
        }

        .log-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .confidence-meter {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .confidence-bar {
            flex: 1;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .confidence-high { background: #28a745; }
        .confidence-medium { background: #ffc107; }
        .confidence-low { background: #dc3545; }

        .navigation {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: #4CAF50;
            transform: scale(1.3);
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .step-content {
                margin-left: 0;
            }

            .navigation {
                display: none;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔬 H743Poten Analysis Workflow</h1>
            <p>Step-by-Step Electrochemical Data Analysis & Cross-Instrument Calibration</p>
        </div>

        <div class="workflow-container">
            <div class="workflow-header">
                <h2>🚀 Interactive Analysis Pipeline</h2>
                <p>Follow the complete workflow from data import to calibrated results</p>
            </div>

            <div class="workflow-steps">
                <!-- Step 1: Data Import -->
                <div class="step active" id="step1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">📁 Data Import & Instrument Selection</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            Select your instrument type and import CV data files. The system supports multiple formats including PalmSens, STM32H743, and other standard electrochemical instruments.
                        </div>
                        
                        <div class="step-details">
                            <h4>🔧 Instrument Selection</h4>
                            <div class="instrument-selector">
                                <div class="instrument-card" onclick="selectInstrument('palmsens')">
                                    <div class="instrument-icon">🔬</div>
                                    <div><strong>PalmSens</strong></div>
                                    <div>Reference Standard</div>
                                </div>
                                <div class="instrument-card selected" onclick="selectInstrument('stm32')">
                                    <div class="instrument-icon">⚡</div>
                                    <div><strong>STM32H743</strong></div>
                                    <div>Target Instrument</div>
                                </div>
                                <div class="instrument-card" onclick="selectInstrument('generic')">
                                    <div class="instrument-icon">📊</div>
                                    <div><strong>Generic CSV</strong></div>
                                    <div>Custom Format</div>
                                </div>
                            </div>

                            <h4>📂 Data Import by Instrument Type</h4>
                            <!-- Instrument Grid Layout -->
                            <div class="instrument-grid">
                                <!-- PalmSens Card -->
                                <div class="instrument-card" id="palmsens-card">
                                    <div class="instrument-header">
                                        <h4>📊 PalmSens</h4>
                                        <div class="quality-badge">Quality: 98%</div>
                                    </div>
                                    <div class="instrument-body">
                                        <input type="file" id="palmsensInput" webkitdirectory multiple class="file-input">
                                        <label for="palmsensInput" class="folder-button">
                                            📂 Choose Folder
                                        </label>
                                        <div class="instrument-details">
                                            <div class="detail-item">
                                                <span class="detail-label">📊 Files:</span>
                                                <span class="detail-value" id="palmsensCount">0</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">💾 Size:</span>
                                                <span class="detail-value" id="palmsensSize">0 MB</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">⚡ Status:</span>
                                                <span class="detail-value status ready" id="palmsens-status">Ready</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- STM32H743 Card -->
                                <div class="instrument-card" id="stm32-card">
                                    <div class="instrument-header">
                                        <h4>⚡ STM32H743</h4>
                                        <div class="quality-badge">Quality: 95%</div>
                                    </div>
                                    <div class="instrument-body">
                                        <input type="file" id="stm32Input" webkitdirectory multiple class="file-input">
                                        <label for="stm32Input" class="folder-button">
                                            📂 Choose Folder
                                        </label>
                                        <div class="instrument-details">
                                            <div class="detail-item">
                                                <span class="detail-label">📊 Files:</span>
                                                <span class="detail-value" id="stm32Count">0</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">💾 Size:</span>
                                                <span class="detail-value" id="stm32Size">0 MB</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">⚡ Status:</span>
                                                <span class="detail-value status ready" id="stm32-status">Ready</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Generic CSV Card -->
                                <div class="instrument-card" id="generic-card">
                                    <div class="instrument-header">
                                        <h4>📁 Generic CSV</h4>
                                        <div class="quality-badge">Quality: 85%</div>
                                    </div>
                                    <div class="instrument-body">
                                        <input type="file" id="genericInput" webkitdirectory multiple class="file-input">
                                        <label for="genericInput" class="folder-button">
                                            📂 Choose Folder
                                        </label>
                                        <div class="instrument-details">
                                            <div class="detail-item">
                                                <span class="detail-label">📊 Files:</span>
                                                <span class="detail-value" id="genericCount">0</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">💾 Size:</span>
                                                <span class="detail-value" id="genericSize">0 MB</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">⚡ Status:</span>
                                                <span class="detail-value status ready" id="generic-status">Ready</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="scanAllFiles()">🔍 Scan All Selected Files</button>
                                <button class="btn btn-secondary" onclick="validateFormat()">✅ Validate File Formats</button>
                            </div>

                            <div class="results-grid">
                                <div class="result-card">
                                    <div class="result-value" id="totalFiles">0</div>
                                    <div class="result-label">Total Files Selected</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="validFiles">0</div>
                                    <div class="result-label">Valid CV Files</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="totalSize">0 MB</div>
                                    <div class="result-label">Combined Data Size</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="instrumentCount">0</div>
                                    <div class="result-label">Instruments Selected</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Data Preprocessing -->
                <div class="step" id="step2">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">⚙️ Data Preprocessing & Quality Check</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            Analyze data quality, handle unit conversions, and prepare data for peak detection algorithms.
                        </div>
                        
                        <div class="step-details">
                            <h4>📊 Data Quality Analysis</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="preprocessProgress" style="width: 0%">0%</div>
                            </div>

                            <div class="log-area" id="preprocessLog">
                                <div>> Initializing data preprocessor...</div>
                                <div>> Checking file formats...</div>
                                <div>> Ready for processing</div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="startPreprocessing()">🚀 Start Processing</button>
                                <button class="btn btn-info" onclick="showDataPreview()">👁️ Preview Data</button>
                            </div>

                            <div class="results-grid">
                                <div class="result-card">
                                    <div class="result-value" id="processedFiles">0</div>
                                    <div class="result-label">Processed Files</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="qualityScore">0%</div>
                                    <div class="result-label">Data Quality</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="unitFormat">Auto</div>
                                    <div class="result-label">Unit Format</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Peak Detection -->
                <div class="step" id="step3">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">🎯 Peak Detection Analysis</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            Apply advanced peak detection algorithms using our 3-method framework: DeepCV, TraditionalCV, and HybridCV.
                        </div>
                        
                        <div class="step-details">
                            {% include 'peak_detection.html' %}
                        </div>
                    </div>
                </div>

                <!-- Step 4: Cross-Instrument Calibration -->
                <div class="step" id="step4">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-title">🔄 Cross-Instrument Calibration</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            Apply machine learning calibration to transform STM32H743 measurements to PalmSens-equivalent accuracy.
                        </div>
                        
                        <div class="step-details">
                            <h4>🤖 Calibration Model Selection</h4>
                            <div class="instrument-selector">
                                <div class="instrument-card selected" onclick="selectCalibration('random_forest')">
                                    <div class="instrument-icon">🌲</div>
                                    <div><strong>Random Forest</strong></div>
                                    <div>Best Performance</div>
                                </div>
                                <div class="instrument-card" onclick="selectCalibration('neural_network')">
                                    <div class="instrument-icon">🧠</div>
                                    <div><strong>Neural Network</strong></div>
                                    <div>Deep Learning</div>
                                </div>
                                <div class="instrument-card" onclick="selectCalibration('gradient_boost')">
                                    <div class="instrument-icon">🚀</div>
                                    <div><strong>Gradient Boosting</strong></div>
                                    <div>High Speed</div>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="startCalibration()">🔄 Start Calibration</button>
                                <button class="btn btn-info" onclick="viewCalibrationDetails()">📊 View Details</button>
                            </div>

                            <div class="results-grid">
                                <div class="result-card">
                                    <div class="result-value" id="calibrationAccuracy">0%</div>
                                    <div class="result-label">Calibration R²</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="potentialError">0%</div>
                                    <div class="result-label">Potential Error</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="currentError">0%</div>
                                    <div class="result-label">Current Error</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Results & Visualization -->
                <div class="step" id="step5">
                    <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-title">📊 Results & Visualization</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            View comprehensive analysis results with interactive visualizations and export options.
                        </div>
                        
                        <div class="step-details">
                            <h4>📈 Visualization Options</h4>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="showCVPlots()">📈 CV Plots</button>
                                <button class="btn btn-info" onclick="showPeakAnalysis()">🎯 Peak Analysis</button>
                                <button class="btn btn-secondary" onclick="showCalibrationComparison()">⚖️ Before/After</button>
                            </div>

                            <div class="visualization-area" id="visualizationArea">
                                <div class="visualization-placeholder">
                                    <p>📊 Interactive visualizations will appear here</p>
                                    <p>Select a visualization option above to begin</p>
                                </div>
                            </div>

                            <h4>💾 Export Results</h4>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="exportJSON()">📄 Export JSON</button>
                                <button class="btn btn-info" onclick="exportCSV()">📊 Export CSV</button>
                                <button class="btn btn-secondary" onclick="generateReport()">📋 Generate Report</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Quality Assurance -->
                <div class="step" id="step6">
                    <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-title">✅ Quality Assurance & Validation</div>
                    </div>
                    <div class="step-content">
                        <div class="step-description">
                            Final quality checks and validation to ensure scientific accuracy and reliability of results.
                        </div>
                        
                        <div class="step-details">
                            <h4>🔍 Quality Metrics</h4>
                            <div class="results-grid">
                                <div class="result-card">
                                    <div class="result-value" id="overallQuality">0%</div>
                                    <div class="result-label">Overall Quality</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="scientificAccuracy">0%</div>
                                    <div class="result-label">Scientific Accuracy</div>
                                </div>
                                <div class="result-card">
                                    <div class="result-value" id="reliabilityScore">0%</div>
                                    <div class="result-label">Reliability Score</div>
                                </div>
                            </div>

                            <h4>📋 Validation Status</h4>
                            <div style="margin: 15px 0;">
                                <div><span class="status-indicator status-completed"></span>Peak Detection Validated</div>
                                <div><span class="status-indicator status-completed"></span>Calibration Applied</div>
                                <div><span class="status-indicator status-completed"></span>Quality Checks Passed</div>
                                <div><span class="status-indicator status-completed"></span>Ready for Scientific Use</div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="finalizeResults()">🎉 Finalize Results</button>
                                <button class="btn btn-info" onclick="shareResults()">🔗 Share Results</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-dot active" onclick="goToStep(1)"></div>
            <div class="nav-dot" onclick="goToStep(2)"></div>
            <div class="nav-dot" onclick="goToStep(3)"></div>
            <div class="nav-dot" onclick="goToStep(4)"></div>
            <div class="nav-dot" onclick="goToStep(5)"></div>
            <div class="nav-dot" onclick="goToStep(6)"></div>
        </div>

        <div class="footer">
            <p>🔬 H743Poten Research Platform | Cross-Instrument Electrochemical Analysis</p>
            <p>Developed with ❤️ for Scientific Excellence</p>
        </div>
    </div>

    <!-- Data Preview Modal -->
    <div id="dataPreviewModal" class="modal">
        <div class="modal-content data-preview-modal">
            <div class="modal-header">
                <h2>📊 Data Preview & Quality Analysis</h2>
                <span class="close" onclick="closeDataPreview()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="preview-tabs">
                    <button class="tab-button active" onclick="showPreviewTab('overview')">📋 Overview</button>
                    <button class="tab-button" onclick="showPreviewTab('graphs')">📈 Graphs</button>
                    <button class="tab-button" onclick="showPreviewTab('statistics')">📊 Statistics</button>
                </div>

                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content active">
                    <div class="data-summary">
                        <div class="summary-grid">
                            <div class="summary-card">
                                <div class="summary-icon">📁</div>
                                <div class="summary-info">
                                    <div class="summary-value" id="previewFileCount">0</div>
                                    <div class="summary-label">Files Loaded</div>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">📊</div>
                                <div class="summary-info">
                                    <div class="summary-value" id="previewDataPoints">0</div>
                                    <div class="summary-label">Data Points</div>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">⚡</div>
                                <div class="summary-info">
                                    <div class="summary-value" id="previewInstrument">STM32</div>
                                    <div class="summary-label">Instrument</div>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-icon">✅</div>
                                <div class="summary-info">
                                    <div class="summary-value" id="previewQuality">95%</div>
                                    <div class="summary-label">Quality Score</div>
                                </div>
                            </div>
                        </div>

                        <div class="data-quality-analysis">
                            <h3>🔍 Data Quality Analysis</h3>
                            <div class="quality-items">
                                <div class="quality-item">
                                    <span class="quality-icon">✅</span>
                                    <span class="quality-text">File format validation passed</span>
                                </div>
                                <div class="quality-item">
                                    <span class="quality-icon">✅</span>
                                    <span class="quality-text">Units converted successfully (μA → A)</span>
                                </div>
                                <div class="quality-item">
                                    <span class="quality-icon">✅</span>
                                    <span class="quality-text">Noise filtering applied</span>
                                </div>
                                <div class="quality-item">
                                    <span class="quality-icon">⚠️</span>
                                    <span class="quality-text">Minor baseline drift detected (correctable)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graphs Tab -->
                <div id="graphs-tab" class="tab-content">
                    <div class="graph-container">
                        <h3>📈 Sample CV Curves</h3>
                        <div style="margin-bottom: 1em;">
                            <label for="cvFileDropdown"><strong>เลือกไฟล์ที่ต้องการแสดงกราฟ:</strong></label>
                            <select id="cvFileDropdown" multiple style="min-width: 300px; min-height: 2.5em;"></select>
                        </div>
                        <div id="plotly-cv-graph" style="width: 100%; max-width: 700px; height: 400px;"></div>
                        <div class="graph-info" id="cv-graph-info"></div>
                    </div>
                </div>

                <!-- Statistics Tab -->
                <div id="statistics-tab" class="tab-content">
                    <div class="statistics-grid">
                        <div class="stat-section">
                            <h4>📊 Voltage Statistics</h4>
                            <div class="stat-item">
                                <span class="stat-label">Min Voltage:</span>
                                <span class="stat-value" id="minVoltage">-1.0V</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Max Voltage:</span>
                                <span class="stat-value" id="maxVoltage">+1.0V</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Scan Rate:</span>
                                <span class="stat-value" id="scanRate">100 mV/s</span>
                            </div>
                        </div>

                        <div class="stat-section">
                            <h4>⚡ Current Statistics</h4>
                            <div class="stat-item">
                                <span class="stat-label">Peak Current:</span>
                                <span class="stat-value" id="peakCurrent">45.2 μA</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Baseline Current:</span>
                                <span class="stat-value" id="baselineCurrent">2.1 μA</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">SNR:</span>
                                <span class="stat-value" id="snrValue">21.5 dB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeDataPreview()">Close</button>
                <button class="btn-primary" onclick="proceedToNextStep()">Continue to Peak Detection</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/workflow_visualization.js') }}?v={{ range(1,10000)|random }}"></script>
    <script src="{{ url_for('static', filename='js/export_utils.js') }}?v={{ range(1,10000)|random }}"></script>
    <script src="{{ url_for('static', filename='js/plot_cv_data.js') }}?v={{ range(1,10000)|random }}"></script>
    <script src="{{ url_for('static', filename='js/real_data_plotter.js') }}?v={{ range(1,10000)|random }}"></script>
    <script>
        // Call loadAndPlotCVData when preview tab is shown
        document.addEventListener('DOMContentLoaded', function() {
            const graphsTab = document.querySelector('[onclick="showPreviewTab(\'graphs\')"]');
            if (graphsTab) {
                graphsTab.addEventListener('click', loadAndPlotCVData);
            }
        });
    </script>
</body>
</html>
