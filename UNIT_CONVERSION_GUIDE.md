# STM32 Unit Conversion & Enhanced CV Analysis Guide

## ЁЯУЛ Overview
р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Щр╕╡р╣Йр╕Ир╕░р╣Бр╕Щр╕░р╕Щр╕│р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕гр╕░р╕Ър╕Ър╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╣Бр╕ер╕░р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М CV р╕Чр╕╡р╣Ир╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╣Бр╕ер╣Йр╕з р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Др╕Яр╕ер╣М STM32 р╕Чр╕╡р╣Ир╕бр╕╡р╕лр╕Щр╣Ир╕зр╕вр╣Ар╕Ыр╣Зр╕Щ A (р╣Бр╕нр╕бр╣Бр╕Ыр╕гр╣М) р╣Бр╕Чр╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕Ыр╣Зр╕Щ ┬╡A (р╣Др╕бр╣Вр╕Др╕гр╣Бр╕нр╕бр╣Бр╕Ыр╕гр╣М)

## ЁЯЧВя╕П Folder Structure
```
H743Poten-Web/
тФЬтФАтФА stm32_unit_converter.py     # р╕кр╕Др╕гр╕┤р╕Ыр╕Хр╣Мр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕в A тЖТ ┬╡A  
тФЬтФАтФА enhanced_cv_calibration.py  # р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М CV р╣Бр╕Ър╕Ър╕Вр╕вр╕▓р╕в
тФЬтФАтФА test_unit_converter.py      # р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕в
тФФтФАтФА test_data/
    тФЬтФАтФА raw_stm32/              # р╣Др╕Яр╕ер╣М STM32 р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ (A units)
    тФФтФАтФА converted_stm32/        # р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╣Бр╕ер╣Йр╕з (┬╡A units)
```

## ЁЯЪА Quick Start Guide

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (р╣Бр╕Щр╕░р╕Щр╕│)
```bash
# 1. Copy р╣Др╕Яр╕ер╣М STM32 р╕Чр╕╡р╣Ир╕бр╕╡р╕лр╕Щр╣Ир╕зр╕в A р╣Др╕Ыр╕Чр╕╡р╣И test_data/raw_stm32/
cp your_stm32_files_with_A_units/* test_data/raw_stm32/

# 2. р╕гр╕▒р╕Щр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Бр╕Ър╕Ъ Enhanced (р╕Ир╕░р╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤)
python3 enhanced_cv_calibration.py
```

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╣Бр╕вр╕Бр╕Хр╣Ир╕▓р╕Зр╕лр╕▓р╕Б
```bash
# 1. Copy р╣Др╕Яр╕ер╣Мр╣Др╕Ыр╕Чр╕╡р╣И test_data/raw_stm32/
cp your_stm32_files/* test_data/raw_stm32/

# 2. р╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╣Бр╕вр╕Б
python3 stm32_unit_converter.py

# 3. р╕гр╕▒р╕Щр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Ыр╕Бр╕Хр╕┤
python3 cv_calibration_simple.py
```

## ЁЯФз р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕гр╕░р╕Ър╕Ър╕гр╕нр╕Зр╕гр╕▒р╕Ъ

### тЬЕ р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕в (A тЖТ ┬╡A):
- Headers р╕Чр╕╡р╣Ир╕бр╕╡: `Current (A)`, `I (A)`, `current(A)`
- р╕Др╣Ир╕▓р╣Гр╕Щр╕лр╕Щр╣Ир╕зр╕в ampere (A) р╣Ар╕Кр╣Ир╕Щ 1.23e-6
- р╕Ир╕░р╕Цр╕╣р╕Бр╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ microampere (┬╡A) р╣Вр╕Фр╕вр╕Др╕╣р╕Ур╕Фр╣Йр╕зр╕в 1e6

### тПня╕П р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Бр╕Ыр╕ер╕З:
- Headers р╕Чр╕╡р╣Ир╕бр╕╡: `Current (┬╡A)`, `I (┬╡A)`, `current(uA)`  
- р╕Др╣Ир╕▓р╣Гр╕Щр╕лр╕Щр╣Ир╕зр╕в ┬╡A р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з

## ЁЯУК р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕в

### р╕Бр╣Ир╕нр╕Щр╣Бр╕Ыр╕ер╕З (A units):
```csv
Voltage (V),Current (A),Time (s)
-0.5,-1.23e-06,0.0
0.0,2.45e-06,1.0  
0.5,1.89e-06,2.0
```

### р╕лр╕ер╕▒р╕Зр╣Бр╕Ыр╕ер╕З (┬╡A units):
```csv
Voltage (V),Current (┬╡A),Time (s)
-0.5,-1.23,0.0
0.0,2.45,1.0
0.5,1.89,2.0
```

## ЁЯзк р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ

### р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕в:
```bash
python3 test_unit_converter.py
```
р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕зр╕гр╣Др╕Фр╣Й:
```
INFO: тЬЕ Conversion successful!
INFO: Conversion ratio for Current (A): 1000000 (should be ~1e6)
```

## ЁЯУИ Features р╕Вр╕нр╕З Enhanced CV Analysis

### ЁЯФД Auto Unit Conversion:
- р╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ър╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕бр╕╡р╕лр╕Щр╣Ир╕зр╕в A р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ ┬╡A р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ
- р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б conversion log р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### ЁЯУК Enhanced Plotting:
- р╣Бр╕вр╕Бр╕Бр╕гр╕▓р╕Яр╕Хр╕▓р╕б scan rate
- р╣Бр╕кр╕Фр╕Зр╕Др╣Ир╕▓ R┬▓ р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░р╣Ар╕кр╣Йр╕Щ calibration
- р╣Бр╕вр╕Бр╣Бр╕кр╕Фр╕Зр╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╣Бр╕ер╣Йр╕зр╣Бр╕ер╕░р╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ
- р╕гр╕нр╕Зр╕гр╕▒р╕Ъ Palmsens р╣Бр╕ер╕░ STM32 р╣Гр╕Щр╕Бр╕гр╕▓р╕Яр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ

### ЁЯФН File Detection:
- р╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ъ source р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (Palmsens/STM32)
- Extract concentration р╣Бр╕ер╕░ scan rate р╕Ир╕▓р╕Бр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М
- р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╕лр╕ер╕▓р╕Бр╕лр╕ер╕▓р╕в

## ЁЯУЭ Conversion Log

р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕кр╕гр╣Йр╕▓р╕З `conversion_log.json` р╕Чр╕╡р╣Ир╕Ър╕▒р╕Щр╕Чр╕╢р╕Б:
- р╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ър╣Бр╕ер╕░р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╣Бр╕ер╣Йр╕з
- columns р╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╣Бр╕Ыр╕ер╕З
- р╕Кр╣Ир╕зр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╣Ир╕нр╕Щр╣Бр╕ер╕░р╕лр╕ер╕▒р╕Зр╣Бр╕Ыр╕ер╕З
- timestamp р╕Вр╕нр╕Зр╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕З

р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З:
```json
{
  "conversion_timestamp": "2025-08-26T18:45:55",
  "total_conversions": 2,
  "conversions": [
    {
      "original_file": "test_data/raw_stm32/sample.csv",
      "converted_file": "test_data/converted_stm32/sample.csv",
      "converted_columns": ["Current (A)"],
      "data_range_before": {"Current (A)": {"min": -1.12e-06, "max": 1.14e-06}},
      "data_range_after": {"Current (A)": {"min": -1.12, "max": 1.14}}
    }
  ]
}
```

## тЪая╕П р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕гр╕░р╕зр╕▒р╕З

1. **Backup р╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ**: р╕гр╕░р╕Ър╕Ър╕Ир╕░р╣Др╕бр╣Ир╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ р╣Бр╕Хр╣Ир╕Др╕зр╕г backup р╣Др╕зр╣Й
2. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕лр╕Щр╣Ир╕зр╕в**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕Яр╕ер╣Мр╕бр╕╡р╕лр╕Щр╣Ир╕зр╕вр╣Ар╕Ыр╣Зр╕Щ A р╕Ир╕гр╕┤р╕Зр╣Ж р╕Бр╣Ир╕нр╕Щр╣Бр╕Ыр╕ер╕З
3. **р╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╕бр╕╡ concentration р╣Бр╕ер╕░ scan rate

## ЁЯОп р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Хр╣Ир╕нр╣Др╕Ы

р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╣Бр╕ер╣Йр╕з р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Ц:
1. р╣Гр╕Кр╣Йр╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Ыр╕ер╕Зр╣Бр╕ер╣Йр╕зр╕гр╣Ир╕зр╕бр╕Бр╕▒р╕Ър╣Др╕Яр╕ер╣Мр╣Ар╕Фр╕┤р╕б
2. р╕гр╕зр╕бр╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ъ Test_data/Stm32 р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
3. р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕гр╕░р╕лр╕зр╣Ир╕▓р╕З Palmsens р╣Бр╕ер╕░ STM32

## ЁЯУЮ Troubleshooting

### р╕Ыр╕▒р╕Нр╕лр╕▓: "No A units detected"
**р╣Бр╕Бр╣Йр╣Др╕В**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ header р╕Вр╕нр╕З CSV file р╕зр╣Ир╕▓р╕бр╕╡ "(A)" р╕лр╕гр╕╖р╕нр╣Др╕бр╣И

### р╕Ыр╕▒р╕Нр╕лр╕▓: "Could not extract concentration"  
**р╣Бр╕Бр╣Йр╣Др╕В**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╕зр╣Ир╕▓р╕бр╕╡р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ р╣Ар╕Кр╣Ир╕Щ "1.0mM" р╕лр╕гр╕╖р╕н "Ferro_10mM"

### р╕Ыр╕▒р╕Нр╕лр╕▓: R┬▓ р╕Хр╣Ир╕│
**р╣Бр╕Бр╣Йр╣Др╕В**: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕╣р╕Бр╣Бр╕Ыр╕ер╕Зр╕лр╕Щр╣Ир╕зр╕вр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И р╣Бр╕ер╕░р╕ер╕нр╕Зр╣Бр╕вр╕Б scan rate