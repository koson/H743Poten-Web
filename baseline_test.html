<!DOCTYPE html>
<html>
<head>
    <title>Baseline Test</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Baseline Visual Test</h1>
    <div id="testPlot" style="width:800px;height:600px;"></div>
    
    <script>
    // Sample data that mimics our backend response structure
    const testData = {
        voltage: [-0.5, -0.4, -0.3, -0.2, -0.1, 0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.4, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.4],
        current: [1e-6, 1.5e-6, 2e-6, 3e-6, 5e-6, 8e-6, 12e-6, 8e-6, 5e-6, 3e-6, 2e-6, 1.5e-6, 1e-6, 0.8e-6, 0.6e-6, 0.5e-6, 0.6e-6, 0.8e-6, 1e-6, 1.2e-6],
        baseline: {
            forward: [0.5e-6, 0.6e-6, 0.7e-6, 0.8e-6, 0.9e-6, 1e-6, 1.1e-6, 1.2e-6, 1.1e-6, 1e-6],
            reverse: [1e-6, 0.9e-6, 0.8e-6, 0.7e-6, 0.6e-6, 0.5e-6, 0.6e-6, 0.7e-6, 0.8e-6, 0.9e-6]
        }
    };
    
    console.log('Test baseline data:', testData.baseline);
    
    // Plot CV data
    const cvTrace = {
        x: testData.voltage,
        y: testData.current,
        mode: 'lines+markers',
        name: 'CV Data',
        line: { color: 'blue' }
    };
    
    // Plot baseline (using our frontend logic)
    const traces = [cvTrace];
    
    if (testData.baseline && testData.baseline.forward && testData.baseline.reverse) {
        const n = testData.voltage.length;
        const mid = Math.floor(n / 2);
        
        console.log(`Total points: ${n}, Mid: ${mid}`);
        console.log(`Forward voltage: ${testData.voltage.slice(0, mid).length} points`);
        console.log(`Forward baseline: ${testData.baseline.forward.length} points`);
        console.log(`Reverse voltage: ${testData.voltage.slice(mid).length} points`);
        console.log(`Reverse baseline: ${testData.baseline.reverse.length} points`);
        
        traces.push({
            x: testData.voltage.slice(0, mid),
            y: testData.baseline.forward,
            mode: 'lines',
            name: 'Forward Baseline',
            line: { color: 'red', width: 2, dash: 'dash' }
        });
        
        traces.push({
            x: testData.voltage.slice(mid),
            y: testData.baseline.reverse,
            mode: 'lines',
            name: 'Reverse Baseline',
            line: { color: 'green', width: 2, dash: 'dash' }
        });
        
        console.log('Created baseline traces!');
    } else {
        console.log('No baseline data found');
    }
    
    Plotly.newPlot('testPlot', traces, {
        title: 'CV Data with Baseline Test',
        xaxis: { title: 'Voltage (V)' },
        yaxis: { title: 'Current (A)' }
    });
    </script>
</body>
</html>